:root{
  --container:1100px;
  --ink:#0f172a; --muted:#64748b; --brand:#1b6ef3;
  --bg:#f8fafc; --card:#fff; --border:#e2e8f0; --shadow:0 10px 30px rgba(15,23,42,.08);
  --map-top:180px;     /* header+toolbar 分 */
  --map-bottom:140px;  /* HUD 分 */
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;color:var(--ink);background:var(--bg)}
a{color:#1b6ef3;text-decoration:none} a:hover{text-decoration:underline}

/* ダークテーマ */
body.theme-dark{ --ink:#e5e7eb; --muted:#94a3b8; --brand:#60a5fa; --bg:#0b1220; --card:#0f172a; --border:#1f2937; --shadow:0 10px 30px rgba(0,0,0,.35); }

.header{position:sticky;top:0;z-index:50;background:var(--card);border-bottom:1px solid var(--border)}
.header-inner{max-width:var(--container);margin:0 auto;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px}
.brand{font-weight:700}
.nav a{margin-left:16px;color:var(--ink)}

.toolbar{max-width:var(--container);margin:0 auto;padding:10px 16px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;transition:all .25s ease}
.toolbar input[type="text"]{flex:1;min-width:220px;padding:10px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--ink)}
.btn{display:inline-block;padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:var(--card);color:var(--ink);font-weight:600}
.btn.primary{background:#1b6ef3;border-color:transparent;color:#fff}
.btn:disabled{opacity:.5;pointer-events:none}

#map{position:fixed;inset:var(--map-top) 0 var(--map-bottom) 0}

/* HUD */
.hud{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,.96);border-top:1px solid var(--border)}
body.theme-dark .hud{background:rgba(15,23,42,.96)}
.hud-inner{max-width:var(--container);margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 16px}
.stat{display:flex;gap:6px;align-items:baseline}.stat b{font-size:20px}

/* Toast & Card */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:108px;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;opacity:.96;display:none;z-index:70}
.card{position:fixed;left:50%;transform:translateX(-50%);top:66px;background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);display:none;min-width:280px;max-width:calc(100vw - 24px);z-index:100}
.card header{padding:10px 14px;border-bottom:1px solid var(--border);font-weight:700}
.card .body{padding:10px 14px}
.card .item{padding:8px;border-radius:8px;cursor:pointer}
.card .item:hover{background:rgba(148,163,184,.15)}
.card.settings .row{margin:10px 0}
.card .actions{margin-top:8px;text-align:right}

/* ナビ中のコンパクト表示 */
body.navigating { --map-top:66px; }
body.navigating .toolbar { height:0; padding:0; overflow:hidden; border:0; }
body.navigating .nav { display:none; }

/* 右上：停止＆追従（ナビ中のみ固定表示） */
#btnStop{position:fixed; top:10px; right:12px; z-index:60; display:none; background:#ef4444; color:#fff; border-color:transparent;}
body.navigating #btnStop{display:inline-block;}
body:not(.navigating) #btnStop{position:static; display:inline-block; background:var(--card); color:var(--ink); border:1px solid var(--border);}
#btnFollowToggle{position:fixed; top:10px; right:112px; z-index:60; display:none; background:var(--card); color:var(--ink); border:1px solid var(--border);}
body.navigating #btnFollowToggle{display:inline-block;}
body:not(.navigating) #btnFollowToggle{display:none;}
@media (max-width:680px){ :root{ --map-top:206px; --map-bottom:160px; } body.navigating{ --map-top:66px; } .hud-inner{flex-wrap:wrap} #btnFollowToggle{ right:108px; } }

/* 進行アイコン＆レーン風カード */
.maneuver{position:fixed; left:50%; transform:translateX(-50%); top:66px; display:none; align-items:center; gap:12px; background:var(--card); color:var(--ink); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:8px 14px; z-index:80}
.maneuver .icon{font-size:34px; line-height:1}
.maneuver .lane{display:flex; gap:6px}
.maneuver .lane-mark{width:18px; height:18px; border:2px solid var(--border); border-radius:4px; opacity:.55}
.maneuver .lane-mark.active{background:#1b6ef3; border-color:#1b6ef3; opacity:1}
.maneuver .text{display:flex; flex-direction:column}
.maneuver .dist b{font-size:18px}
.maneuver .sub{font-size:14px; color:var(--muted)}

/* 再中心ボタン（手動パン時のみ表示） */
.fab{position:fixed; right:12px; bottom:calc(var(--map-bottom) + 12px); z-index:60; border-radius:999px; padding:12px 14px; background:var(--card); border:1px solid var(--border); box-shadow:var(--shadow); display:none}
body.follow-paused .fab{display:inline-block}

/* ---- optional: keep follow button inline with stop ---- */
#btn-follow { vertical-align: middle; }
.controls-row, .controls { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; }

.search-results { margin-top: 8px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff; }
.sr-item { display:block; width:100%; text-align:left; padding:10px 12px; border:0; border-bottom:1px solid #eee; background:transparent; cursor:pointer; }
.sr-item:last-child { border-bottom:0; }
.sr-empty,.sr-loading,.sr-error { padding:10px 12px; color:#666; }

/* === click-through fix: keep header/toolbar/cards above the map === */
.header,
.toolbar,
#searchCard,
#settingsCard,
#toast {
  position: relative;
  z-index: 1000;   /* map より前面に固定 */
  pointer-events: auto;
}

/* map は最背面に固定（既存指定がある場合でも上書き） */
#map {
  position: relative;   /* 既に absolute の場合は absolute のままでOK */
  z-index: 0 !important;
}

/* 万一、全画面オーバーレイが残っていてクリックを塞いでる場合は無効化 */
.overlay-blocker,
.fullscreen-overlay {
  pointer-events: none !important;
}

/* 検索候補カード/設定カードはデフォルト非表示（表示時のみクリック有効） */
#searchCard,
#settingsCard {
  display: none;
}
